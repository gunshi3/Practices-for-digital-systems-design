C51 COMPILER V9.51   IR                                                                    04/24/2019 15:14:26 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE IR
OBJECT MODULE PLACED IN ir.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE ir.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /**********************
   2          myIr1  ºìÍâÍ¨ĞÅ1£¬µ¥×Ö½Ú
   3          ĞÍºÅ:STC15F2K60S2 Ö÷Æµ:11.0592MHz
   4          ************************/
   5          #include <STC15F2K60S2.H>
   6          #define uint  unsigned int
   7          #define uchar unsigned char
   8          
   9          /*---------ºê¶¨Òå---------*/
  10          #define cstKeyCheckTime 75          //°´¼üÏû¶¶µÄÖÜÆÚ
  11          #define cstKeyMinTime 50            //°´¼üÊ¶±ğ±»Îª°´ÏÂÊ±Ğè¼ì²âµ½µÄ×îÉÙ´ÎÊı
  12          
  13          /*---------Òı½Å±ğÃû¶¨Òå---------*/
  14          sbit sbtSel0 = P2 ^ 0;                              //Î»Ñ¡ĞÅºÅ
  15          sbit sbtSel1 = P2 ^ 1;                              //Î»Ñ¡ĞÅºÅ
  16          sbit sbtSel2 = P2 ^ 2;                              //Î»Ñ¡ĞÅºÅ
  17          sbit sbtLedSel = P2 ^ 3;                            //ÊıÂë¹ÜºÍLEDµÄÑ¡ÔñĞÅºÅ
  18          
  19          sbit sbtPutIr = P3 ^ 5;                             //ºìÍâÏß·¢ËÍÒı½Å
  20          sbit sbtGetIr = P3 ^ 7;                             //´®¿Ú1·¢ËÍÒı½Å
  21          
  22          sbit sbtKey1 = P3 ^ 2;                              //°´¼ü1  ·¢ËÍĞÅºÅ
  23          sbit sbtKey2 = P3 ^ 3;                              //°´¼ü2  Êı¾İ¼Ó1
  24          sbit sbtKey3 = P1 ^ 7;                              //°´¼ü3  ÊÕ·¢Ä£Ê½¿ª¹Ø
  25          
  26          /*---------±äÁ¿¶¨Òå---------*/
  27          int time = cstKeyCheckTime;                 //°´¼üÏû¶¶ÖÜ¼ÆÊı(Ò»¸öÖÜÆÚ¼ì²âcstKeyCheckTime´Î)
  28          int intKey1Cnt = 0;                         //ÖÜÆÚÖĞ¼ì²âµ½sbtKey1=0µÄ´ÎÊı
  29          int intKey2Cnt = 0;                         //ÖÜÆÚÖĞ¼ì²âµ½sbtKey2=0µÄ´ÎÊı
  30          int intKey3Cnt = 0;                         //ÖÜÆÚÖĞ¼ì²âµ½sbtKey3=0µÄ´ÎÊı
  31          int intKey1State = 1;       //sbtKey1×´Ì¬£ºÉèÖÃÎª0´ú±íÒÑ°´ÏÂ£¬1´ú±íÎ´°´ÏÂ
  32          int intKey2State = 1;       //sbtKey2×´Ì¬£ºÉèÖÃÎª0´ú±íÒÑ°´ÏÂ£¬1´ú±íÎ´°´ÏÂ
  33          int intKey3State = 1;       //sbtKey3×´Ì¬£ºÉèÖÃÎ¬0´ú±íÒÑ°´ÏÂ£¬1´ú±íÎ´°´ÏÂ
  34          
  35          uint  uiSeg7Num = 0;              //ÊıÂë¹ÜÏÔÊ¾µÄÊı×Ö
  36          uchar ucPutIrFlagN = 1;             //×´Ì¬±ê¼Ç£º0´ú±í¿É·¢ËÍ£¬1ºÍ2´ú±í²»¿É·¢ËÍ
  37          int intMyBuf = 11;                 //½ÓÊÕ»º³å£¬ÓÃÓÚÊÕ·¢±êÖ¾0xcaµÄÅĞ¶Ï
  38          uchar arrSegSelect[] =              //¶ÎÑ¡£¬ÏÔÊ¾0-f
  39          {
  40              0x3f, 0x06, 0x5b, 0x4f,
  41              0x66, 0x6d, 0x7d, 0x07,
  42              0x7f, 0x6f, 0x77, 0x7c,
  43              0x39, 0x5e, 0x79, 0x71
  44          };
  45          
  46          /*---------º¯ÊıÉùÃ÷---------*/
  47          //ÖĞ¶Ïº¯Êı³ıÍâ
  48          void TimerInit();      //¶¨Ê±Æ÷ÉèÖÃ
  49          void Uart1Init();      //´®¿Ú1ÉèÖÃ
  50          void Init();          //³õÊ¼»¯£¬ÍÆÍì£¬ÉèÖÃÖĞ¶Ï¿ª¹Ø
  51          void DigSelct( int );   //ÉèÖÃÊıÂë¹ÜÎ»Ñ¡
  52          void CheckKey();     //Ïû¶¶¼ì²âÒÔ¼°°´¼ü²Ù×÷(¶¨Ê±Æ÷0ÖĞ¶ÏÖĞµ÷ÓÃ)
  53          
  54          /*---------Ö÷º¯Êı---------*/
  55          void main()
C51 COMPILER V9.51   IR                                                                    04/24/2019 15:14:26 PAGE 2   

  56          {
  57   1          TimerInit();        //ÉèÖÃ¶¨Ê±Æ÷
  58   1          Uart1Init();            //ÉèÖÃ´®¿Ú1
  59   1          Init();                 //³õÊ¼»¯
  60   1          while( 1 );
  61   1      }
  62          
  63          /*---------³õÊ¼»¯º¯Êı---------*/
  64          //ÉèÖÃÍÆÍì£¬ÖĞ¶Ï¿ª¹ØÉèÖÃ
  65          void Init()
  66          {
  67   1          P0M1 = 0x00;
  68   1          P0M0 = 0xff;
  69   1          P2M1 = 0x00;
  70   1          P2M0 = 0x08;
  71   1          //ÖĞ¶Ï¿ª¹ØÉèÖÃ£¬Ïê¼ûÊı¾İÊÖ²áP458
  72   1          ET1 = 0;            //½ûÖ¹T1ÖĞ¶Ï
  73   1          ET0 = 1;            //´ò¿ª¶¨Ê±Æ÷T0ÖĞ¶Ï
  74   1          ES = 1;             //´ò¿ª´®¿Ú1ÖĞ¶Ï
  75   1          IE2 = 0X04;         //´ò¿ª¶¨Ê±Æ÷2ÖĞ¶Ï
  76   1          EA = 1;             //´ò¿ª×ÜÖĞ¶Ï
  77   1      }
  78          
  79          /*---------´®¿Ú1³õÊ¼»¯º¯Êı---------*/
  80          void Uart1Init()    //ÉèÖÃ·½·¨¼ûÊı¾İÊÖ²áP621(´®¿Ú1ÉèÖÃ)ºÍP498(¶¨Ê±Æ÷T1ÉèÖÃ)
  81          {
  82   1          PCON &= 0x7F;       //²¨ÌØÂÊ²»±¶ËÙ£¬SMOD=0
  83   1          SCON = 0x50;        //´®¿Ú1Ê¹ÓÃ¹¤×÷·½Ê½1£¬REN=1(ÔÊĞí´®ĞĞ½ÓÊÕ)
  84   1          AUXR &= 0xFE;       //´®¿Ú1Ñ¡Ôñ¶¨Ê±Æ÷T1×÷Îª²¨ÌØÂÊ·¢ÉúÆ÷£¬S1ST2=0
  85   1          AUXR1 = 0x40;       //´®¿Ú1ÔÚP3.6½ÓÊÕ£¬ÔÚP3.7·¢ËÍ
  86   1          PS = 1;             //ÉèÖÃ´®¿ÚÖĞ¶ÏÎª×î¸ßÓÅÏÈ¼¶
  87   1      }
  88          
  89          /*---------¶¨Ê±Æ÷³õÊ¼»¯º¯Êı---------*/
  90          void TimerInit()    //ÉèÖÃ·½·¨¼ûÊı¾İÊÖ²áP498
  91          {
  92   1          AUXR |= 0x40;       //¶¨Ê±Æ÷T1Îª1TÄ£Ê½£¬ËÙ¶ÈÊÇ´«Í³8051µÄ12±¶£¬²»·ÖÆµ¡£
  93   1          TMOD &= 0x0F;     //Çå³ıT1Ä£Ê½Î»
  94   1          TMOD |= 0x20;      //ÉèÖÃT1Ä£Ê½Î»£¬Ê¹ÓÃ8Î»×Ô¶¯ÖØ×°Ä£Ê½
  95   1          TL1 = 0x70;         //ÉèÖÃ³õÖµ
  96   1          TH1 = 0x70;         //ÉèÖÃT1ÖØ×°Öµ
  97   1          TR1 = 1;            //T1ÔËĞĞ¿ØÖÆÎ»ÖÃ1£¬ÔÊĞíT1¼ÆÊı
  98   1      
  99   1          AUXR |= 0x80;       //¶¨Ê±Æ÷T0Îª1TÄ£Ê½£¬µÄËÙ¶ÈÊÇ´«Í³8051µÄ12±¶£¬²»·ÖÆµ¡£
 100   1          TMOD &= 0xF0;       //Çå³ıT0Ä£Ê½Î»
 101   1          TMOD |= 0x02;       //ÉèÖÃT0Ä£Ê½Î»£¬Ê¹ÓÃ8Î»×Ô¶¯ÖØ×°Ä£Ê½
 102   1          TL0 = 0x70;          //ÉèÖÃ³õÖµ
 103   1          TH0 = 0x70;         //ÉèT0ÖØ×°Öµ
 104   1          TF0 = 0;             //T0Òç³ö±êÖ¾Î»ÇåÁã
 105   1          TR0 = 1;             //T0ÔËĞĞ¿ØÖÆÎ»ÖÃ1£¬ÔÊĞíT0¼ÆÊı
 106   1      
 107   1          //¶¨Ê±Æ÷T2ÓÃÓÚÏÔÊ¾ºÍ°´¼üÏû¶¶£¬500us¶¨Ê±16Î»×Ô¶¯ÖØ×°
 108   1          AUXR |= 0x04;       //¶¨Ê±Æ÷T2Îª1TÄ£Ê½
 109   1          T2L = 0x66;         //µÍÎ»ÖØ×°Öµ
 110   1          T2H = 0xEA;         //¸ßÎ»ÖØ×°Öµ
 111   1          AUXR |= 0x10;       //¶¨Ê±Æ÷2¿ªÊ¼¼ÆÊ±
 112   1      }
 113          
 114          /*---------ÊıÂë¹ÜÏÔÊ¾Î»µÄÑ¡Ôñº¯Êı---------*/
 115          void DigSelct( int x )
 116          {
 117   1          sbtSel0 = x % 2;
C51 COMPILER V9.51   IR                                                                    04/24/2019 15:14:26 PAGE 3   

 118   1          sbtSel1 = x % 4 / 2;
 119   1          sbtSel2 = x / 4;
 120   1      }
 121          
 122          /*---------°´¼ü¼ì²âº¯Êı---------*/
 123          //Ïû¶¶ÖÜÆÚÖĞÒ»´Î°´¼üµÄ¼ì²â£¬ÒÔ¼°¼ì²âcstKeyCheckTime´ÎºóµÄ²Ù×÷£¨ĞèÒª¶à´ÎÖØ¸´µ÷ÓÃ£©
 124          void CheckKey()
 125          {
 126   1          time--;
 127   1          if( sbtKey1 == 0 )
 128   1              intKey1Cnt++;
 129   1          if( sbtKey2 == 0 )
 130   1              intKey2Cnt++;
 131   1          if( sbtKey3 == 0 )
 132   1              intKey3Cnt++;
 133   1          if( time <= 0 )                                 //Ò»¸öÖÜÆÚ½áÊø
 134   1          {
 135   2              if( intKey1Cnt >= cstKeyMinTime )   //ÅĞ¶ÏsbtKey1±»¼ì²âÎª°´ÏÂµÄ´ÎÊıÊÇ·ñ´óÓÚ°´¼üÊ¶±ğ±»Îª°´ÏÂĞè¼ì²âµ
             -½µÄ×îÉÙ´ÎÊı
 136   2              {
 137   3                  if( intKey1State == 1 )             //ÅĞ¶ÏÊÇ·ñÒÑ¾­±»°´ÏÂ
 138   3                  {
 139   4                      if( ucPutIrFlagN == 0 )         //ÅĞ¶ÏÊÇ·ñ¿ÉÒÔ·¢ËÍ
 140   4                      {
 141   5                          ucPutIrFlagN = 1;         //µÚÒ»´ÎÏÈ·¢ËÍÒ»¸ö±êÖ¾  PS£ºÈç¹û²»Ôö¼ÓÕâ¸ö±êÖ¾£¬ÔÚÈÕ¹âµÆÏÂÀ´
             -»ØÕÚµ²½ÓÊÕÍ·¿ÉÄÜ»á½ÓÊÕµ½¸ÉÈÅĞÅºÅ
 142   5                          SBUF = 0xca;             //±êÖ¾Îª0xca£¬·¢ËÍÍêºóÔÚ´®¿ÚÖĞ¶ÏÖĞÔÙ·¢ËÍÊı¾İ
 143   5                      }
 144   4                      intKey1State = 0;               //×´Ì¬¸Ä±äÎªÒÑ¾­±»°´ÏÂ
 145   4                  }
 146   3              }
 147   2              else
 148   2                  intKey1State = 1;                   //×´Ì¬¸Ä±äÎªÎ´±»°´ÏÂ
 149   2      
 150   2              if( intKey2Cnt >= cstKeyMinTime )
 151   2              {
 152   3                  if( intKey2State == 1 )
 153   3                  {
 154   4                      uiSeg7Num++;                  //Êı¾İ¼Ó1
 155   4                      uiSeg7Num %= 10;
 156   4                      intKey2State = 0;
 157   4                  }
 158   3              }
 159   2              else
 160   2                  intKey2State = 1;
 161   2      
 162   2              if( intKey3Cnt >= cstKeyMinTime )
 163   2              {
 164   3                  if( intKey3State == 1 )
 165   3                  {
 166   4                      ucPutIrFlagN = !ucPutIrFlagN;       //ÄÜ·ñ·¢ËÍµÄÇĞ»»
 167   4                      REN = ~REN;                    //½ÓÊÕÔÊĞí±êÖ¾Î»£¬1´ú±í¿É½ÓÊÕ£¬0´ú±í²»¿É½ÓÊÕ
 168   4                      intKey3State = 0;
 169   4                  }
 170   3              }
 171   2              else
 172   2                  intKey3State = 1;
 173   2      
 174   2              time = cstKeyCheckTime;
 175   2              intKey1Cnt = 0;
 176   2              intKey2Cnt = 0;
 177   2              intKey3Cnt = 0;
C51 COMPILER V9.51   IR                                                                    04/24/2019 15:14:26 PAGE 4   

 178   2          }
 179   1      }
 180          
 181          /*---------¶¨Ê±Æ÷0ÖĞ¶Ï·şÎñº¯Êı---------*/
 182          void T0_Process() interrupt 1
 183          {
 184   1          if( sbtGetIr == 0 )     //sbtPutIr¸ù¾İsbtGetIrµÄĞÅºÅ²úÉúÂö³å
 185   1          {
 186   2              sbtPutIr = ~sbtPutIr;
 187   2          }
 188   1          else                        //Èç¹ûP3.7=1ÔòP3.5Êä³ö0
 189   1              sbtPutIr = 0;
 190   1      }
 191          
 192          /*---------´®¿Ú1ÖĞ¶Ï·şÎñº¯Êı---------*/
 193          //·¢ËÍÍê±ÏTI×Ô¶¯ÖÃ1£¬²úÉúÖĞ¶Ï; ½ÓÊÕÍê±ÏRIÖµ1£¬²úÉúÖĞ¶Ï
 194          void Uart1_Process() interrupt 4
 195          {
 196   1          if( TI )                        //ÅĞ¶ÏÊÇ·ñ·¢ËÍÖĞ¶Ï
 197   1          {
 198   2              TI = 0;                     //·¢ËÍÖĞ¶ÏÇëÇó±êÖ¾Î»Çå0
 199   2              if( ucPutIrFlagN == 1 )         //ÅĞ¶ÏÊÇ·ñµÚÒ»´Î·¢ËÍ
 200   2              {
 201   3                  ucPutIrFlagN = 2;        //µÚ¶ş´Î·¢ËÍÊı¾İ
 202   3                  SBUF = uiSeg7Num;       //·¢ËÍuiSeg7Num
 203   3              }
 204   2              if( ucPutIrFlagN == 2 )         //ÅĞ¶ÏÊÇ·ñµÚ¶ş´Î·¢ËÍÍê±Ï
 205   2                  ucPutIrFlagN = 0;         //·¢ËÍÍêucPutIrFlagNÇåÁã
 206   2          }
 207   1          if( RI )                         //ÅĞ¶ÏÊÇ·ñ½ÓÊÕÖĞ¶Ï
 208   1          {
 209   2              RI = 0;                     //½ÓÊÕÖĞ¶ÏÇëÇó±êÖ¾Î»Çå0
 210   2              if( intMyBuf == 0xca )          //ÅĞ¶ÏÉÏÒ»´ÎÊÇ·ñÊÕµ½0xca±êÖ¾
 211   2                  uiSeg7Num = SBUF;       //ÕıÊ½½ÓÊÕÊı¾İ
 212   2              intMyBuf = SBUF;            //°ÑÕâ´Î½ÓÊÕµ½µÄÊı¾İ´æÈë×Ô¶¨ÒåµÄ»º´æÖĞ£¬µÈ´ıÏÂÒ»´ÎµÄ±È½Ï
 213   2          }
 214   1      }
 215          
 216          /*---------¶¨Ê±Æ÷2ÖĞ¶Ï·şÎñº¯Êı---------*/
 217          void T2_Process() interrupt 12
 218          {
 219   1      
 220   1          P0 = 0;                              //P0ÇåÁã
 221   1          sbtLedSel = ~sbtLedSel;                 //ÇĞ»»ÏÔÊ¾
 222   1          if( sbtLedSel == 0 )
 223   1          {
 224   2              DigSelct( 7 );                      //Ñ¡ÔñÊıÂë¹ÜµÄµÚÆßÎ»
 225   2              P0 = arrSegSelect[uiSeg7Num];       //ÉèÖÃÊıÂë¹ÜÏÔÊ¾ÄÚÈİ
 226   2          }
 227   1          else
 228   1              P0 = !ucPutIrFlagN;                //ÉèÖÃ·¢¹âµÄLEDµÆ
 229   1          CheckKey();                         //°´¼üÏû¶¶¼ì²â
 230   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    547    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     35    ----
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.51   IR                                                                    04/24/2019 15:14:26 PAGE 5   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
