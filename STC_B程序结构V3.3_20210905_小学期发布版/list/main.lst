C51 COMPILER V9.51   MAIN                                                                  09/12/2021 22:56:21 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE source\main.c BROWSE INCDIR(.\inc) DEBUG OBJECTEXTEND PRINT(.\list\main.lst
                    -) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          /******************  STCBSPDemoSTC_DemoV3 *************************** 
   2          STCBSPṩĵײֺ֧Ӧò㺯֧"STC-Bѧϰ"ͬʱ
   3               1ʾ
   4               2LEDָʾʾ
   5               3ʵʱʱ
   6               4¶ȹղ
   7               5ֲ
   8               6FM
   9               7EXTչӿڣӳӡࡢתPWMƣ4ѡ1
  10               8񶯴
  11               9
  12               10
  13               111ͨ
  14               122ͨţ485EXTչӿڣ2ѡ1
  15               13ң
  16               14շͨ
  17               15ʧNVM洢DS1302ṩ31ֽڣM24C02ṩ256ֽڣ
  18          ʹ÷μģͷļ
  19          
  20          STC_DemoV3ʾԴmain.cmain.hfunction.cɣ£     
  21              1Key2л"ʾ"""ģʽģʽֵLEDʾģʽУ
  22                     ģʽ1ʵʱʱӣգ
  23                     ģʽ2ʵʱʱӣʱ룩
  24                     ģʽ3¶ȡղ
  25                     ģʽ4ֲ
  26                     ģʽ5FM
  27                     ģʽ6ࣨҪEXTϽӳģ飩
  28                     ģʽ7ӳ    ҪEXTϽӵӳģ飩
  29              2ʾܣ
  30                     ģʽ1£ʾʵʱʱRTC   "--" "" ˳"""ϡ
             -¡"
  31                     ģʽ2£ʾʵʱʱRTC   "ʱʱ-ַ-" "" ˳"ʱ""ϡ
             -¡"
  32                     ģʽ3£ʾ¶ȡADֵ"  ", ޲
  33                     ģʽ4£ʾ      "    " "" ͣ/ţ"ϡ""
             -"
  34                     ģʽ5£ʾ      "   ƵʣMHz" "" 浱ǰNVM´
             -ϵʱøò
  35                                                                                   "ϡ"""Ƶ
  36                     ģʽ6£ʾ       "       ֵcm"  ޲ 
  37                     ģʽ7£ʾ       "ADCֵ"  ޲  
  38               31ʱⷢ "Һã""STC-Bѧϰ"ñô֣ò120
             -0bpsıշʽɿյ"Һã"ı    
  39                  3̧ʱ1 ܲܲѭÿÿû
             -ȶʧ   
  40               4񶯴ֲţֲ"ͣ/"
  41               5дųӽʱУ1350Hz1ʱ䣩
  42               61˫ͨţ1200bps
  43                         յһ"AA 55"ͷС8ֽݰ򽫵7ֽ+1Բ2400bps򴮿2485EXT
             -ѡתݰ
  44                         ӿյݰ++룩򴮿1ת
  45               72ѡ485˫򵥹EXTTTL Uart˫˫λã2400bps
  46                         յһ"AA 55"ͷС8ֽݰ򽫵7ֽ+2IrתݰNEC_R05d
             -Э飩
C51 COMPILER V9.51   MAIN                                                                  09/12/2021 22:56:21 PAGE 2   

  47               8շӿڣ
  48                         ӿյݰ++룩1000Hz300mS򴮿1ת
  49                         ݰͷΪ"AA 55"3ֽΪ F1Ƶʣ45ֽڣBCD룬Ƶֵ0
             -.1MHzЧ8871080
  50                                                                              6ֽݣЧ015     
             -  7ֽ+4
  51                                                      3ֽΪ F2RTCʱ루456ֽݣBCD룩Ч
             -7ֽ+4
  52                                                      3ֽΪ F3RTCգ456ֽݣBCD룩Ч7ֽ+4
  53                                                  ֵNVM
  54                                                  1000Hz600mS
  55                                                  򴮿1ת
  56          
  57          ƣɣ绰18008400450    202195
  58          **********************************************************************************************************
             -*****************/
  59          
  60          
  61          //******* û1ûļ *************//
  62          #include "main.H"                              //롣дӦóʱд main.h  main.cļ 
  63          #include "song.c"                              //song.cбд֣ͬһ׸裩
  64          //******* û2ûԶ庯 *************//
  65          
  66          
  67          //******* û3ûȫֱ *************//
  68          struct_DS1302_RTC t={0x30,0,9,0x06,9,1,0x21};  // ʵʱʱݽṹ롢֡ʱա¡ܡꡣֵ
             -202196գһ90030
  69          struct_FMRadio    FM;                          // FMݽṹƵʡGP1GP2GP3
             -ֵ95.5MHz5
  70          struct_SysPerF    SysPer;                      // ϵͳݽṹÿѭ4ֽڡÿѯ
             -1ֽ
  71          struct_ADC        ADCresult;                   // ADֵ           
  72          unsigned char Music_tone,Music_PM;             // ֲڴգÿӽ
  73          
  74          unsigned char rxd[8];                          //ͨţ12⹲ã8ֽ
  75          unsigned char rxdhead[2]={0xaa,0x55};          //ͨţ12հͷƥַ2ֽڣ0xAA
             -0x55    
  76          
  77          unsigned char funcmode;                  //ʾģʽ
  78          enum funcname {RTC_YMD=1,                      //ģʽʵʱʱӣ
  79                         RTC_HMS,                        //                    ʵʱʱӣʱ
  80                         Rt_Rop,                         //                    
  81                         Music,                          //                    ֲ
  82                         FMradio,                        //                    FM
  83                         UltroSonic,                     //                    
  84                         Weight};                        //                    ӳ
  85          unsigned char tempadj;                   //ʱʱã=1 ʱ=2 » =3  
             -
  86          
  87          //******* û4ûԶ庯ԭ *************//
  88          #include "function.c" 
  89          
  90          void myUart1Rxd_callback()                    //1յϷݰصϷݰAA55.
             -.....8ֽڣ
  91          { if ( GetUart2TxStatus() == enumUart2TxFree )                  
  92   1          { (*(rxd+6)) += 1;                                          //7ֽڼ1
  93   2             Uart2Print(&rxd, sizeof(rxd));                           //ݰӴ2(485EXTչӿ)
             -ȥ
  94   2          }     
  95   1      }
  96          
  97          void myUart2Rxd_callback()                    //2յϷݰصϷݰAA55.
C51 COMPILER V9.51   MAIN                                                                  09/12/2021 22:56:21 PAGE 3   

             -.....8ֽڣ
  98          { if ( GetIrStatus() == enumIrFree ) 
  99   1         { (*(rxd+6)) += 2;                                             //7ֽڼ2
 100   2           IrPrint(&rxd, sizeof(rxd));                                  //ݰӺⷢͳȥ
 101   2         }
 102   1      }
 103          
 104          void myIrRxd_callback()                      //յݰصкǰ++NEC_R
             -05d룩  
 105          { dealwithIrRxd();  
 106   1      }
 107          
 108          void my1mS_callback()                       //1mS¼ص
 109          {  
 110   1      }
 111            
 112          void my10mS_callback()                      //10mS¼ص
 113          { 
 114   1      }
 115          
 116          void my100mS_callback()                     //100mS¼ص
 117          { dealwithDisp();                          
 118   1      }      
 119                         
 120          void my1S_callback()                       //1S¼ص
 121          {   
 122   1      }
 123          
 124          void myADC_callback()                      //ADC¼ص
 125          { 
 126   1      }
 127          
 128          void myKN_callback()                                                                              //
             -¼ص
 129          { dealwithmyKN();   
 130   1      }
 131          
 132          void mykey_callback()                               // Key1Key2¼ص
 133          { dealwithmykey();    
 134   1      }
 135          
 136          void myhall_callback()                                                                    //ʾhall¼
             -ص
 137          { if(GetHallAct() == enumHallGetClose) SetBeep(1350,100);   
 138   1      }
 139          
 140          void mySV_callback()                                                                      //ʾ: ¼
             -ֲ/ͣ
 141          { if(GetVibAct())
 142   1        if (GetPlayerMode() == enumModePause) SetPlayerMode(enumModePlay); 
 143   1            else  SetPlayerMode(enumModePause);     
 144   1      }
 145          
 146          //******* main() *************//  
 147          void main() {         // main() ʼ         //б룡 
 148   1        
 149   1      //******* û5ûmain()ڲֲ *************//
 150   1        
 151   1      //******* û6ûmain()ʼ *************//   
 152   1      //1,Ҫõģ(ɸģṩغ)
 153   1          Key_Init();                                      //Ҫõģ鼰亯ʼ
             -׼Ӧ̨
C51 COMPILER V9.51   MAIN                                                                  09/12/2021 22:56:21 PAGE 4   

 154   1          HallInit();                                      //
 155   1          VibInit();                                       //
 156   1          DisplayerInit();                                 //
 157   1          BeepInit();                                      //
 158   1          MusicPlayerInit();                               //
 159   1          AdcInit(ADCexpEXT);                              //ADCģʼвѡչӿEXTP1.0
             -P1.1ǷҲADC
 160   1          StepMotorInit();                                 //ʼ
 161   1          DS1302Init(t);                                   //DS1302ʼ
 162   1            
 163   1          IrInit(NEC_R05d);                                //ӿ
 164   1          /******* ¿4ѡ1EXTӿ ********/    
 165   1      //    EXTInit(enumEXTWeight);                          //EXTʼɵӳӹ
 166   1      //    EXTInit(enumEXTPWM);                             //EXTʼ·PWM
 167   1      //    EXTInit(enumEXTDecode);                          //EXTʼʽ빦ܣ磺ת
             -
 168   1      //    EXTInit(enumEXTUltraSonic);                      //EXTʼɳ๦
 169   1          Uart1Init(1200);                                 //1ʼвUart1ͨŲ
 170   1          /******* ¿2ѡ1ش2 ********/    
 171   1          Uart2Init(2400,Uart2Usedfor485);                 //2ʼ485ӿڣRS485ҵֳߣ˫
             -
 172   1      //    Uart2Init(2400,Uart2UsedforEXT);               //2ʼEXTӿڣTTL Uartͨſڣ
 173   1          
 174   1      //2,¼ص(sysṩúSetEventCallBack()) 
 175   1          SetEventCallBack(enumEventKey, mykey_callback);            //
 176   1          SetEventCallBack(enumEventSys1mS, my1mS_callback);         //
 177   1          SetEventCallBack(enumEventSys10mS, my10mS_callback);       //
 178   1          SetEventCallBack(enumEventSys100mS, my100mS_callback);     //
 179   1          SetEventCallBack(enumEventSys1S, my1S_callback);           //
 180   1          SetEventCallBack(enumEventHall, myhall_callback);          //
 181   1          SetEventCallBack(enumEventVib, mySV_callback);             //
 182   1          SetEventCallBack(enumEventNav, myKN_callback);             //õص
 183   1          SetEventCallBack(enumEventUart1Rxd, myUart1Rxd_callback);  //ô1ջص
 184   1          SetEventCallBack(enumEventUart2Rxd, myUart2Rxd_callback);  //ô2ջص
 185   1          SetEventCallBack(enumEventXADC,myADC_callback);            //չӿµADֵ¼
 186   1          SetEventCallBack(enumEventIrRxd,myIrRxd_callback);         //Irյһݰ
 187   1      
 188   1      //3,û״̬ʼ  
 189   1          SetDisplayerArea(0,7);                           //
 190   1          SetUart1Rxd(&rxd, sizeof(rxd), rxdhead, sizeof(rxdhead));   //ôڽշʽݰݰ
             -rxdУݰСrxdСݰͷҪrxdheadƥ䣬ƥrxdheadС
 191   1          SetUart2Rxd(&rxd, sizeof(rxd), rxdhead, sizeof(rxdhead)); 
 192   1          SetIrRxd(&rxd);                                     //
 193   1          
 194   1      //4,ûʼ
 195   1          FM=FM_NVMread();                              //FMRadioʼ
 196   1          FMRadioInit(FM);  
 197   1          
 198   1          Music_PM=90;
 199   1          Music_tone=0xFC;
 200   1          funcmode = M24C02_Read(0x00);                               
 201   1          LedPrint(funcmode); 
 202   1          
 203   1      /*****************  MySTC_OS ʼؿʼ  ********************************/   
 204   1          MySTC_Init();     // MySTC_OS ʼ         //б룡   
 205   1        while(1)            // ϵͳѭ              //б룡     
 206   1          { MySTC_OS();     // MySTC_OS            //б룡
 207   2      /*****************  MySTC_OS ʼؽ  ********************************/  
 208   2            
 209   2      //******* û7ûmain()ѭ *************//
 210   2            
 211   2            
C51 COMPILER V9.51   MAIN                                                                  09/12/2021 22:56:21 PAGE 5   

 212   2          }               //ѭwhile(1)         //б룡 
 213   1      }                   // main()          //б룡 
 214          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3040    ----
   CONSTANT SIZE    =    199    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     43      23
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
